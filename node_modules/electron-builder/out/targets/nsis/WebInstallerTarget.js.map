{"version":3,"file":"WebInstallerTarget.js","sourceRoot":"","sources":["../../../src/targets/nsis/WebInstallerTarget.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,AAAO,AAAE,AAAkB,AAAE,AAAiB,AAAE,AAA8B,AAAE,AAAM,AAA8B;;;;;;AAEpH,AAAO,AAAE,AAAU,AAAE,AAAM,AAAc;;;;AAIzC,AAAe,AACf,AAAM;MAA0B,AAAQ,AAAU;AAChD,gBAAY,AAAqB,UAAE,AAAc,QAAE,AAAkB,YAAE,AAA+B;AACpG,AAAK,cAAC,AAAQ,UAAE,AAAM,QAAE,AAAU,YAAE,AAAa,AAAC;AAElD,AAAE,AAAC,YAAC,AAAI,KAAC,AAAO,QAAC,AAAmB,uBAAI,AAAI,AAAC,MAAC,AAAC;AAC7C,AAAI,iBAAC,AAAO,QAAC,AAAmB,sBAAG,AAAI,AACzC;AAAC,AACH;AAAC;AAED,QAAI,AAAc;AAChB,AAAM,eAAC,AAAI,AACb;AAAC;AAEe,AAAgB,oBAAtB,AAAK,CAAkB,AAAiB,UAAE,AAAY;;;;AAC9D,AAA8B;AAC9B,kBAAO,AAAU,+CAAC,AAAgC,UAAC,AAAgB,iBAAC,AAAI,AAAC,AAAI,YAAE,AAAQ,UAAE,AAAO,AAAC;AAEjG,kBAAM,AAAQ,WAAG,AAAI,MAAC,AAAQ;AAC9B,kBAAM,AAAO,UAAG,AAAI,MAAC,AAAyB;AAE9C,gBAAI,AAAa,gBAAG,AAAO,QAAC,AAAa;AACzC,AAAE,AAAC,gBAAC,AAAa,iBAAI,AAAI,AAAC,MAAC,AAAC;AAC1B,sBAAM,AAAc,iBAAG,MAAM,AAA8B,gFAAC,AAAQ,WAAE,MAAM,AAAiB,mEAAC,AAAQ,UAAE,AAAI,MAAC,AAAO,SAAE,AAAI,AAAC,QAAE,AAAI,AAAC;AAClI,AAAE,AAAC,oBAAC,AAAc,kBAAI,AAAI,QAAI,AAAc,eAAC,AAAM,WAAK,AAAC,AAAC,GAAC,AAAC;AAC1D,0BAAM,IAAI,AAAK,MAAC,AAAyC,AAAC,AAC5D;AAAC;AAED,AAAa,gCAAG,AAAkB,oEAAC,AAAc,eAAC,AAAC,AAAC,IAAE,AAAI,MAAE,AAAQ,AAAC;AAErE,AAAO,wBAAC,AAA4B,+BAAG,AAAI,AAC7C;AAAC;AAED,AAAO,oBAAC,AAAe,kBAAG,AAAa,AACzC;;AAAC;AAED,QAAc,AAAwB;AACpC,AAA6C;AAC7C,AAAM,eAAC,AAA4C,AACrD;AAAC;AAES,AAA2B;AACnC,cAAM,AAAO,UAAG,AAAI,KAAC,AAAQ,SAAC,AAAO;AACrC,cAAM,AAAU,aAAG,AAAO,QAAC,AAAI,KAAC,AAAW,AAAE,kBAAK,AAAO,QAAC,AAAI,AAAC,AAAC,OAAC,AAAW,AAAC,AAAC,cAAC,AAAU;AACzF,AAAM,AAAC,kBAAG,AAAO,QAAC,AAAI,QAAI,AAAU,cAAI,AAAO,QAAC,AAAO,OAAM,AAC/D;AAAC,AACF","sourcesContent":["import { computeDownloadUrl, getPublishConfigs, getPublishConfigsForUpdateInfo } from \"../../publish/PublishManager\"\nimport { WinPackager } from \"../../winPackager\"\nimport { NsisTarget } from \"./NsisTarget\"\nimport { NsisWebOptions } from \"./nsisOptions\"\nimport { AppPackageHelper } from \"./nsisUtil\"\n\n/** @private */\nexport class WebInstallerTarget extends NsisTarget {\n  constructor(packager: WinPackager, outDir: string, targetName: string, packageHelper: AppPackageHelper) {\n    super(packager, outDir, targetName, packageHelper)\n\n    if (this.options.differentialPackage == null) {\n      this.options.differentialPackage = true\n    }\n  }\n\n  get isWebInstaller(): boolean {\n    return true\n  }\n\n  protected async configureDefines(oneClick: boolean, defines: any): Promise<any> {\n    //noinspection ES6MissingAwait\n    await (NsisTarget.prototype as WebInstallerTarget).configureDefines.call(this, oneClick, defines)\n\n    const packager = this.packager\n    const options = this.options as NsisWebOptions\n\n    let appPackageUrl = options.appPackageUrl\n    if (appPackageUrl == null) {\n      const publishConfigs = await getPublishConfigsForUpdateInfo(packager, await getPublishConfigs(packager, this.options, null), null)\n      if (publishConfigs == null || publishConfigs.length === 0) {\n        throw new Error(\"Cannot compute app package download URL\")\n      }\n\n      appPackageUrl = computeDownloadUrl(publishConfigs[0], null, packager)\n\n      defines.APP_PACKAGE_URL_IS_INCOMLETE = null\n    }\n\n    defines.APP_PACKAGE_URL = appPackageUrl\n  }\n\n  protected get installerFilenamePattern(): string {\n    // tslint:disable:no-invalid-template-strings\n    return \"${productName} Web Setup ${version}.${ext}\"\n  }\n\n  protected generateGitHubInstallerName(): string {\n    const appInfo = this.packager.appInfo\n    const classifier = appInfo.name.toLowerCase() === appInfo.name ? \"web-setup\" : \"WebSetup\"\n    return `${appInfo.name}-${classifier}-${appInfo.version}.exe`\n  }\n}"]}
